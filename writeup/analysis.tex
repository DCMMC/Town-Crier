\section{Security Analysis}
\label{sec:analysis}

Proofs of theorems in this section appear in Appendix~\ref{sec:analysis-proofs}.


\paragraph{Authenticity.}
Intuitively, authenticity means that an adversary (including a corrupt user, relay, or collusion thereof)
cannot convince \tcont to accept a datagram that differs from the expected content obtained by crawling the specified \weburl at the specified time.
In our formal definition, we assume that the user and \tcont behave honestly.
Recall that the user must verify upfront the attestation $\sigatt$ that vouches for the enclave's public key $\pksgx$.

\begin{definition}[Authenticity of Data Feed]
We say that the \tc protocol satisfies \emph{authenticity of data feed} if,
for any polynomial-time adversary $\algA$ that can interact arbitrarily with $\fsgx$,
$\algA$ cannot persuade an honest verifier to accept $(\pksgx, \sigatt, \dgform:=(\weburl, \pkurl, T), \dgm, \sigma)$
where $\dgm$ is not the contents of $\weburl$ with the public key $\pkurl$ at time $T$.
More formally, for any probabilistic polynomial-time adversary $\algA$,
\[
\begin{array}{l}
\Pr\left[
\begin{array}{l}
(\pksgx, \sigatt, {\sf id}, {\sf params}, {\sf data}, \sigma) \leftarrow 
\algA^{\fsgx}(1^\lambda) :\\
\quad \left(\sigsgx.{\sf Verify}(\pkM, \sigatt, (\enclaveprog, \pksgx)) = 1\right) \wedge \\
\quad \left(\Sigma.{\sf Verify}(\pksgx, {\sf id}, {\sf params}, {\sf data})  = 1\right) \wedge\\
\quad {\sf data} \neq \enclaveprog({\sf params}) 
\end{array}
\right] \\[3pt] 
\leq {\sf negl}(\lambda)
\end{array}
\]
\label{defn:auth}
\end{definition}


\begin{theorem}[Authenticity]
\label{thm:authenticity}
Assume that $\sigsgx$
and $\Sigma$ are secure signature schemes.
%and assume that the cryptographic protocol used to realize the secure channel
%with $\pkurl$ is secure;
Then, the full \tc
protocol achieves authenticity of data feed under Definition~\ref{defn:auth}.\footnote{Recall
that we
model SGX's group signature as a regular signature
scheme under a manufacturer public key $\pkM$ using the model in~\cite{sgxsok}.}
\end{theorem}




\paragraph{Fee Safety.}
Our protocol in Section~\ref{sec:gas-protocol} ensures that an honest \tcs will not run out of money
and that an honest requester will not pay excessive fees.

\begin{theorem}[Gas neutrality for Town Crier]
\label{thm:tc-gas-neutral}
If the \tc~\medname is honest,
Town Crier's wallet $\tcadd$ will have at least $\constgasmax$ remaining after each {\bf Deliver} call.
\end{theorem}

An honest user should only have to pay for computation that is executed honestly on their behalf.
If a valid datagram is delivered, this is a constant value plus the cost of executing \dgcallback.
Otherwise the request should be able to recover the cost of executing {\bf Deliver}.
For Theorem~\ref{thm:tc-gas-neutral} to hold, \tcont must retain a small fee on cancellation,
but we allow the user to recover all but a small constant amount.
We formalize this intuition in Theorem~\ref{thm:fair-expenditure}

\begin{theorem}[Fair Expenditure for Honest Requester]
\label{thm:fair-expenditure}
For any $\dgform$ and $\dgcallback$,
let $\constgasrequest$ and $\consthonestfee$ be the respective values chosen by an honest requester for $\gasrequest$ and $\fee$
when submitting the request $(\dgform, \dgcallback, \fee, \gasrequest)$.
For any such request submitted by an honest user $\reqcont$, one of the following holds:
\vspace{-0.4em}
\begin{itemize}
  \setlength{\itemsep}{2pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item $\dgcallback$ is invoked with a valid datagram matching the request parameters $\dgform$
    and the requester spends at most $\constgasrequest + \constgasinvokecancel + \consthonestfee$.

  \item The requester spends at most $\constgasrequest + \constgasinvokecancel + \constgascancel$.
\end{itemize}
\end{theorem}





\paragraph{Other security concerns.} We address concerns about attacks against the basic SGX isolation model embraced in the basic \tc protocol in Section~\ref{subsec:enhanced_robustness}. A threat we do not address in \tc is the risk of traffic analysis by a network adversary or compromised \medname against confidential applications (e.g., with private datagrams), but briefly discuss the issue in Section~\ref{sec:applications}.



\section{Experiments}
\label{sec:experiments}

\begin{table*}[ht]
\centering
\begin{tabular}{lrr|rr|rr}
\toprule
& \multicolumn{2}{c|}{\sf CashSettledPut} &
  \multicolumn{2}{c|}{\sf FlightIns} &
  \multicolumn{2}{c}{\sf SteamTrade} \\
  & time(ms) & proportion & time(ms) & proportion  & time(ms) & proportion\\
\midrule
Context switch & 0.41    & 0.21\%   & 0.44      & 0.08\%    & 0.89    & 0.07\%\\
Web scraper         & 181.03  & 94.12\%  & 512.32    & 98.02\%   & 1297.73 & 99.11\%\\
Sign                & 10.63   & 5.53\%   & 9.64      & 1.85\%    & 10.45   & 0.80\%\\
Serialization       & 0.28    & 0.14\%   & 0.25      & 0.05\%    & 0.32    & 0.02\%\\
\midrule
Total               & 192.35  & 100.00\%    & 522.65    & 100.00\% & 1309.39 & 100.00\%\\
\bottomrule
\end{tabular}
\caption{Running time of handling a request \elaine{Fan to 1) add std dev;
2)update context switch time to include
time switching out too}}
\label{tab:eval_profiling}
\end{table*}



%\begin{table*}[ht]
%\centering
%\begin{tabular}{lrr|rr|rr}
%\toprule
%& \multicolumn{2}{c|}{\sf CashSettledPut} & 
%  \multicolumn{2}{c|}{\sf FlightIns} &
%  \multicolumn{2}{c}{\sf SteamTrade} \\ 
%\midrule
%& \multicolumn{2}{c|}{\bf Enclave response time}
%& \multicolumn{2}{c|}{\bf Enclave response time}
%& \multicolumn{2}{c}{\bf Enclave response time} \\
%  & time(ms) & \multicolumn{1}{c|}{proportion} & time(ms) & \multicolumn{1}{c|}{proportion} & time(ms) & \multicolumn{1}{c}{proportion}\\
%%\midrule
%Context switch & 0.41    & 0.21\%   & 0.44      & 0.08\%    & 0.89    & 0.07\%\\
%Web scraper         & 181.03  & 94.12\%  & 512.32    & 98.02\%   & 1297.73 & 99.11\%\\
%Sign                & 10.63   & 5.53\%   & 9.64      & 1.85\%    & 10.45   & 0.80\%\\
%Serialization       & 0.28    & 0.14\%   & 0.25      & 0.05\%    & 0.32    & 0.02\%\\
%%\midrule
%{\bf Total}     & {\bf 192.35}  & {100.00}\%    & {\bf 522.65}  & 100.00\% & 
%{\bf 1309.39} & 100.00\%\\
%\bottomrule
%\end{tabular}
%\caption{Running time of handling a request \elaine{Fan to 1) add std dev;
%2)update context switch time to include
%time switching out too}}
%\label{tab:eval_profiling}
%\end{table*}
%

We evaluated the performance of \tc on a Dell Inspiron 13-7359 laptop equipped
with an Intel i7-6500U CPU and 8.00GB memory.  This model is chosen 
because it is one of the few SGX-enabled systems available on the market at the
writing of this paper. Although the hosting platform is just moderately preferment, we
show that on a single host, the current implementation is able to handle 
transactions generated by Ethereum blockchain in real time. 
\elaine{todo: modify
the previous sentence 
after Fan's new experiments are done.}


\subsection{Enclave Response Time}
% justify why a laptop is used 
We measured the enclave response time for handling a request. Here ``enclave response time''
is defined as the difference between 1) the time 
the relay decides to send a request to an SGX enclave;
and 2) the time the relay gets a response back from the SGX enclave. 
For each application, we repeat the  
experiment 5 times, and report the mean and the standard deviation.  
\elaine{change accordingly after Fan puts in the std dev}

%The measurement begins
%at the point when a request is discovered and ends at the point when the
%response is sent to delivery. 
%Propagation latency of the Ethereum network
%is not measured since it is out of the control of \tc. 

Table \ref{tab:eval_profiling} summarizes the total enclave response
time as well as its breakdown. 
The table suggests that for the three applications we implemented
the enclave response time ranges from {\bf 192 ms}
to {\bf 1309 ms}.  \elaine{update numbers after Fan updates table}
The response time 
is clearly dominated by the web scraper time, i.e., the time it takes to 
fetch the requested information from a website.
Among the three applications 
evaluated, {\sf SteamTrade} has the longest web scraper time, 
since in the case of {\sf SteamTrade}, the web scraper
must interact with the website over multiple roundtrips to fetch the desired datagram.

%Web scrapers contribute the most to the
%total execution time. This portion of running time
%is application-specific and mainly depends on the
%amount of fetched data.

%Suggested by Table \ref{tab:eval_profiling}, fetching web pages 
%over HTTPS is the most expensive operation. This is because: 1)
%fetching data triggers
%a lot of context switches 
%and data transferring between the enclave and untrusted application;
%2) networking latency is reflected 

\subsection{Transaction Throughput}
We performed a sequence of experiments running 1 to 20 enclaves 
on a single SGX-enable laptop
machine, and investigated the transaction throughput 
enabled by a single SGX machine. 
Note that SGX allows at most 20 enclaves on the specific machine model we used.
Figure \elaine{refer to Fan's new figure} 
shows that for the three applications evaluated,
a single SGX machine can handle
\elaine{blah to blah} 
tx/sec.

We give several meaningful data points of comparison to show
why a single SGX machine suffices to handle the load of
today's blockchains: 
Ethereum as of today handles 
\elaine{fill in} tx/sec on average. 
Bitcoin today handles
\elaine{fill in} tx/sec, and 
its maximum throughput (when the full block size is utilized)
would be roughly 7 tx/sec.
We know of no measurement study that 
investigates the fundamental 
throughput bound of the Ethereum  peer-to-peer network.
However, for Bitcoin, it has been shown that without
redesigning the protocol, 
Bitcoin cannot scale beyond  
42 tx/sec by simple reparametrization of its block size.
\elaine{cite}
Therefore, Town Crier will not be a throughput 
bottleneck when used 
with decentralized blockchains --- it appears 
more imminent to scale up 
the blockchain protocols themselves.


\begin{table*}[ht]
\centering
\begin{tabular}{lr|r|r}
\toprule
& \multicolumn{1}{c|}{\sf CashSettledPut} &
  \multicolumn{1}{c|}{\sf FlightIns} &
  \multicolumn{1}{c}{\sf SteamTrade} \\
%  & gas (cents) & gas (cents) & gas (cents) \\
\midrule
Delivery before issuing cancel & ?? & ?? & ?? \\ 
Cancel arrived after delivery & & & \\ 
Cancel, no delivery & & & \\ 
\bottomrule
\end{tabular}
\caption{{\bf Callback-independent} portion of the gas expenditure, translated
to USD.  Here the difference between the gas expenditure across applications
is mainly caused 
by the difference in length of input parameters and output datagrams.
\elaine{ethan: check}
}
\label{tab:eval_gas}
\end{table*}



\subsection{Gas Costs}
One ether is currently worth about \$5 and 1 gas costs $5 \cdot 10^{-8}$ ether, meaning 4 million gas is approximately \$1.
Here we give values for our implementation for the gas variables we defined in Section \ethan{ref gas constant definitions} (all units are in gas).
In Town Crier, we set $\constgasmin$ to be 35000 gas units (i.e.  \elaine{fill} cents),
and $\constgasmax$ to be 3100000 gas units (i.e., \elaine{fill in} cents --- the latter is limited by 
Ethereum's inherent {\tt GASLIMIT}.

The cost for executing {\bf Request} is approximately \num[group-separator={,}]{120000} 
gas (i.e., \elaine{fill} cents) 
fixed cost, 
plus \num[group-separator={,}]{2500} gas (i.e., \elaine{fill} cents) 
for every 32 bytes of request parameters.
The cost for executing the callback-independent portion of {\bf Delivery}, eventually paid
by the requesting user, is \elaine{blah} gas (i.e., \elaine{fill in} cents).
The cost for executing {\bf Cancel} is \elaine{fill in} gas (i.e., \elaine{fill} cents) ---
this includes 
the gas cost  
\elaine{fill in notation for honest party's choice of this value}
as well as the refund paid to Town 
Crier should delivery happen after cancel
\elaine{fill in notation}.




\subsection{Resilience against Component Compromise}

\elaine{add some eval results here.}

\subsection{Offline Measurements}
We characterize several measurements 
performed during the offline phase, 
include the cost for generating and verifying SGX attestations,
as well as clock calibration   
measurements.


%Recall that a user must verify  
%an SGX enclave's attestation offline to securely establish 
%the identity $\pkTC$. 
%Our experiments show that the 

Recall that a one-time operation is required offline
for the enclave to be established, and  



Recall that the absolute time of the \encname is verified
by including a signed time stamp in the attestation and letting 
clients check it it in real time. Therefore the latency
of attestation generation plus a round-trip time
define the precision of the absolute clock. 
We evaluated the cycles consumed in generating an attestation and
signing a Unix time stamp.


\begin{table}[ht]
\centering
\begin{tabular}{lr}
\toprule
  & time(ms) \\
\midrule
Report Generation & $18.46$ \\
Quote Generation & $64.94$ \\
Signing the time stamp & $11.50$ \\
\bottomrule
\end{tabular}
\caption{Running time of generating \att}
\label{tab:eval_att}
\end{table}

Table \ref{tab:eval_att} summarizes the running time break down of generating an
attestation along with a signed time stamp.  Note that two steps are involved in
generating \att: first a report is produced within the \encname; then, an
attestation, as known as a quote, is produced by QE based on the report passed
to it. Note that \att only need to be generated once throughout the lifetime of the
enclave.




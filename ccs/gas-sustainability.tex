\section{Gas Sustainability}
\label{sec:gas-sustainability}

The simplified payment-free protocol in Section~\ref{sec:payment-free-protocol} guarantees authenticity of data for an honest user.
In Ethereum, however, computation is not free; recall from Section~\ref{sec:contracts-and-gas} that Ethereum employs \emph{gas} to fuel contracts.
This means that \tc needs enough gas to deliver datagrams, so users must pay a fee to reimburse costs.
If fees are not properly handled, a malicious user could prevent delivery of a datagram.
In fact, this concern is not unique to \tc; any Ethereum-based service must ensure that its fees can be reimbursed.

As we described in Section~\ref{sec:contracts-and-gas}, all gas for the call to a contract is paid by the user who initiates the transaction,
regardless of what other contracts are called as part of execution.
Thus for any service which consists only of Ethereum smart contracts, the service inherently cannot be vulnerable to a fee-based attack;
the client must directly pay all fees for any use (or misuse) of the service.
However, \tc does not reside entirely on the blockchain;
The \medname and \encname both reside off the blockchain and must initiate a transaction to respond to a request.
Because \tc must initiate the transaction, it must pay the gas for the associated computation.
This opens the potential for an attacker to submit malicious requests and cause \tc to repeatedly pay to ``respond'' to these requests and not receive proper reimbursement.
To ensure the availability of the service, we must guard against such an attack.

For \tc, there is only one point at which \tc initiates a blockchain transaction: {\bf Deliver}.
This leads us to the following definition.

\begin{definition}[\tc Gas Sustainability]
  \label{def:tc-gas-sustainability}
  We say that \tc is \emph{gas sustainable} if, whenever the \medname is honest and \tcadd contains sufficient funds to execute {\bf Deliver},
  then executing {\bf Deliver} cannot decrease the balance of \tcadd.
\end{definition}

We note two strange aspects of this definition.
First, we require the \medname to be honest.
Upon inspection, this requirement makes sense.
The \medname controls all network activity into and out of the \encname and can thus trivially mount a DoS attack.
It makes sense to only require that our behavior prevent one type of DoS attacks while others are not occurring.
More importantly, the \medname is part of the \tc system, so \tc cannot hope to function properly without an honest \medname.
We can generalize this clause very simply by restricting to external attacks;
if a service is attacking itself, we make no attempt to guarantee availability.

Second, we require that the balance of \tcadd not decrease.
This requirement appears quite strict.
In reality we need only require that \tc be able to afford every legal set of executions.
Because \tc has only one way to spend ether and the amount provided need not depend on the balance of \tcadd,
this requirement is equivalent to the balance never decreasing.

In a more general case, there may be multiple ways to initiate blockchain computation or multiple wallets.
Therefore, we simply require that the service not get stuck due to lack of gas.
Intuitively we wish to ensure that, if a service is initialized with sufficient gas and behaves honestly,
then for any sequence of calls, it will be able to pay the gas cost of each call it executes.

More formally, we can let a service $S$ be a set of smart contract functions $f_1, \dotsc, f_n$, a set of wallets $\wallet_1, \dotsc \wallet_m$,
and a protocol describing which functions will be called by which wallet in response to specific user-initiated calls to functions.
Let $(f_i(x), P, g)$ denote a call to function $f_i$ with input $x$ made by user $P$ with {\tt GASLIMIT} $g$.
\ethan{What is a ``protocol'' here? I need to define that more formally.}

\begin{definition}[Gas Sustainability]
  \label{def:gas-sustainability}
  We say that a service $\displaystyle S = \left(\{f_i\}_1^F, \{\wallet_i\}_1^W\right)$ and protocol are \emph{gas sustainable}
  if there exist some $K_1, \dotsc, K_W$ such that the following holds.
  For all sequences of calls $(f_{i_1}(x_1), P_1, g_1), \dotsc, (f_{i_n}(x_N), P_N, g_N)$ allowable under the protocol with and honest service (and potentially malicious users),
  if ${\sf balance}(\wallet_i) \geq K_i$ for all $1 \leq i \leq m$ prior to the first call,
  then for every $j$ such that $P_j = \wallet_k$ for some $k$, $g_j$ is sufficient to fully execute $f_{i_j}(x_j)$ and $\wallet_k$ contains at least $g_j$ ether between execution $j-1$ and execution $j$.
\end{definition}

